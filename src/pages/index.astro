---
import Layout from '../layouts/Layout.astro';
import { api } from '../../convex/_generated/api';

const features = [
	{
		name: 'Community Support',
		description: 'Connect with others who understand your journey with MCTD.',
		icon: 'ðŸ‘¥'
	},
	{
		name: 'Expert Insights',
		description: 'Access reliable information and the latest research about MCTD.',
		icon: 'ðŸ”¬'
	},
	{
		name: 'Personal Stories',
		description: 'Read and share experiences living with MCTD.',
		icon: 'ðŸ“–'
	}
];
---

<Layout title="MCTD Warrior - Living with Mixed Connective Tissue Disease">
	<!-- Hero section -->
	<div class="relative">
		<div class="absolute inset-x-0 bottom-0 h-1/2 bg-gray-100"></div>
		<div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
			<div class="relative shadow-xl sm:rounded-2xl sm:overflow-hidden">
				<div class="absolute inset-0">
					<div class="absolute inset-0 bg-gradient-to-r from-primary to-purple-800 mix-blend-multiply"></div>
				</div>
				<div class="relative px-4 py-16 sm:px-6 sm:py-24 lg:py-32 lg:px-8">
					<h1 class="text-center text-4xl font-extrabold tracking-tight sm:text-5xl lg:text-6xl">
						<span class="block text-white">Welcome to MCTD Warrior</span>
					</h1>
					<p class="mt-6 max-w-lg mx-auto text-center text-xl text-gray-200 sm:max-w-3xl">
						Your trusted resource for living with Mixed Connective Tissue Disease. Join our community of warriors sharing experiences and support.
					</p>
					<div class="mt-10 max-w-sm mx-auto sm:max-w-none sm:flex sm:justify-center">
						<div class="space-y-4 sm:space-y-0 sm:mx-auto sm:inline-grid sm:grid-cols-2 sm:gap-5">
							<a
								href="/blog"
								class="flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-primary bg-white hover:bg-gray-50 sm:px-8"
							>
								Read Blog
							</a>
							<a
								href="/about"
								class="flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary-dark hover:bg-opacity-70 sm:px-8"
							>
								Learn More
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Features section -->
	<div class="relative bg-white py-16 sm:py-24 lg:py-32">
		<div class="mx-auto max-w-md px-4 text-center sm:max-w-3xl sm:px-6 lg:max-w-7xl lg:px-8">
			<h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">Why Join Our Community?</h2>
			<p class="mt-5 max-w-prose mx-auto text-xl text-gray-500">
				Together we're stronger. Join a supportive community that understands your journey.
			</p>
			<div class="mt-12">
				<div class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
					{features.map(feature => (
						<div class="pt-6">
							<div class="flow-root bg-gray-50 rounded-lg px-6 pb-8">
								<div class="-mt-6">
									<div class="inline-flex items-center justify-center p-3 bg-primary rounded-md shadow-lg transform -translate-y-1/2">
										<span class="text-3xl" aria-hidden="true">{feature.icon}</span>
									</div>
									<h3 class="mt-8 text-lg font-medium text-gray-900 tracking-tight">{feature.name}</h3>
									<p class="mt-5 text-base text-gray-500">{feature.description}</p>
								</div>
							</div>
						</div>
					))}
				</div>
			</div>
		</div>
	</div>

	<!-- Latest posts section -->
	<div class="relative bg-gray-50 py-16 sm:py-24 lg:py-32">
		<div class="relative">
			<div class="text-center mx-auto max-w-md px-4 sm:max-w-3xl sm:px-6 lg:px-8 lg:max-w-7xl">
				<h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">Latest Blog Posts</h2>
				<p class="mt-5 mx-auto max-w-prose text-xl text-gray-500">
					Stay updated with our latest articles, stories, and resources.
				</p>
			</div>
			<div class="mt-12 mx-auto max-w-md px-4 grid gap-8 sm:max-w-lg sm:px-6 lg:px-8 lg:grid-cols-3 lg:max-w-7xl">
				<div id="latest-posts" class="grid gap-8 sm:grid-cols-1 lg:grid-cols-3">
					<!-- Posts will be dynamically inserted here -->
					<div class="flex flex-col rounded-lg shadow-lg overflow-hidden">
						<div class="flex-shrink-0">
							<div class="h-48 w-full bg-gray-200 animate-pulse"></div>
						</div>
						<div class="flex-1 bg-white p-6 flex flex-col justify-between">
							<div class="flex-1">
								<div class="h-4 bg-gray-200 rounded w-3/4 mb-4 animate-pulse"></div>
								<div class="h-4 bg-gray-200 rounded w-1/2 animate-pulse"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="mt-10 text-center">
				<a
					href="/blog"
					class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
				>
					View All Posts
				</a>
			</div>
		</div>
	</div>

	<!-- Newsletter section -->
	<div class="bg-white">
		<div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:py-16 lg:px-8">
			<div class="px-6 py-6 bg-primary rounded-lg md:py-12 md:px-12 lg:py-16 lg:px-16 xl:flex xl:items-center">
				<div class="xl:w-0 xl:flex-1">
					<h2 class="text-2xl font-extrabold tracking-tight text-white sm:text-3xl">
						Want to stay updated?
					</h2>
					<p class="mt-3 max-w-3xl text-lg leading-6 text-gray-200">
						Sign up for our newsletter to receive the latest updates and resources.
					</p>
				</div>
				<div class="mt-8 sm:w-full sm:max-w-md xl:mt-0 xl:ml-8">
					<form class="sm:flex">
						<label for="email-address" class="sr-only">Email address</label>
						<input
							id="email-address"
							name="email-address"
							type="email"
							autocomplete="email"
							required
							class="w-full border-white px-5 py-3 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-primary focus:ring-white rounded-md"
							placeholder="Enter your email"
						/>
						<button
							type="submit"
							class="mt-3 w-full flex items-center justify-center px-5 py-3 border border-transparent shadow text-base font-medium rounded-md text-primary bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-primary focus:ring-white sm:mt-0 sm:ml-3 sm:w-auto sm:flex-shrink-0"
						>
							Subscribe
						</button>
					</form>
					<p class="mt-3 text-sm text-gray-200">
						We care about your privacy. Read our <a href="/privacy" class="text-white font-medium underline">Privacy Policy</a>.
					</p>
				</div>
			</div>
		</div>
	</div>
</Layout>

<script>
	import { ConvexProvider, useConvex } from 'convex/react';
	import { api } from '../../convex/_generated/api';

	// Function to format date
	function formatDate(date: Date) {
		return new Intl.DateTimeFormat('en-US', {
			year: 'numeric',
			month: 'long',
			day: 'numeric'
		}).format(date);
	}

	// Function to load latest posts
	async function loadLatestPosts() {
		try {
			const convex = useConvex();
			const posts = await convex.query(api.posts.list);
			const latestPosts = posts.filter(post => post.published).slice(0, 3);

			const postsContainer = document.getElementById('latest-posts');
			if (!postsContainer) return;

			postsContainer.innerHTML = latestPosts.map(post => `
				<div class="flex flex-col rounded-lg shadow-lg overflow-hidden">
					<div class="flex-1 bg-white p-6 flex flex-col justify-between">
						<div class="flex-1">
							<p class="text-sm font-medium text-primary">
								<time datetime="${new Date(post._creationTime).toISOString()}">
									${formatDate(new Date(post._creationTime))}
								</time>
							</p>
							<a href="/blog/${post.slug}" class="block mt-2">
								<p class="text-xl font-semibold text-gray-900">${post.title}</p>
								<p class="mt-3 text-base text-gray-500">${post.excerpt}</p>
							</a>
						</div>
					</div>
				</div>
			`).join('');
		} catch (error) {
			console.error('Error loading posts:', error);
		}
	}

	// Load posts when the page loads
	loadLatestPosts();
</script>
